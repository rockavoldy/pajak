<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Bea Masuk Barang Impor</title>
    <link href="/styles.css" rel="stylesheet">
    <!-- <script src="/htmx_1.9.5.min.js"></script> -->
    <script>
        var currencyDataList = []

        fetch("/kurs/")
            .then(res => res.json())
            .then(resData => {
                console.log(resData)
                const currencyChoice = document.getElementById("currencyChoice")
                currencyChoice.innerHTML = ""
                const currencyData = document.getElementById("currencyData")

                resData.data.currencies.forEach(function(currency) {
                    const optionHtml = document.createElement("option")
                    optionHtml.value = currency.symbol
                    optionHtml.innerText = currency.name
                    currencyChoice.appendChild(optionHtml)

                    const divRow = document.createElement("div")
                    divRow.classList.value = "table-row"

                    const divSymbol = document.createElement("div")
                    divSymbol.classList.value = "table-cell border-b border-slate-400"
                    divSymbol.innerText = currency.symbol

                    const divValue = document.createElement("div")
                    divValue.classList.value = "table-cell border-b border-slate-400"
                    divValue.innerText = currency.value
                    
                    divRow.appendChild(divSymbol)
                    divRow.appendChild(divValue)

                    currencyData.appendChild(divRow)

                    currencyDataList.push({
                        "symbol": currency.symbol,
                        "value": currency.value
                    })
                })
            }).finally(() => console.log(currencyDataList));
            // while (currencyDataList.length == 0) {}
            console.log(currencyDataList)
    </script>
</head>
<body>
    <div class="mx-auto w-screen h-screen justify-center flex bg-slate-800 text-white">
        <div class="w-6/12">
            <h1 class="text-xl text-center mt-3">Kalkulator Pajak Dalam Rangka Impor</h1>
            <form class="w-full table mt-5 mx-5">
                <div class="w-full table-row px-2 py-1 rounded border">
                    <div class="table-cell py-1">
                        <label for="currencyChoice">Pilih mata uang</label>
                    </div>
                    <div class="table-cell py-1">
                        <select id="currencyChoice" name="currency" class="rounded border p-1 border-slate-500 bg-slate-600">
                            <option value="USD" selected>USD</option>
                        </select>
                    </div>
                </div>
                <div class="w-full table-row px-2">
                    <div class="table-cell py-1">
                        <label for="cost">Harga barang</label>
                    </div>
                    <div class="table-cell py-1">
                        <input type="number" id="cost" class="rounded pl-2 border border-slate-500 bg-slate-600" name="cost" />
                    </div>
                </div>
                <div class="w-full table-row px-2">
                    <div class="table-cell py-1">
                        <label for="insurance">Biaya asuransi</label>
                    </div>
                    <div class="table-cell py-1">
                        <input type="number" id="insurance" class="rounded pl-2 border border-slate-500 bg-slate-600" name="insurance" />
                    </div>
                </div>
                <div class="w-full table-row px-2">
                    <div class="table-cell py-1">
                        <label for="freight">Ongkos kirim</label>
                    </div>
                    <div class="table-cell py-1">
                        <input type="number" id="freight" class="rounded pl-2 border border-slate-500 bg-slate-600" name="freight" />
                    </div>
                </div>
                <div class="w-full table-row px-2">
                    <div class="table-cell py-1">
                        <label for="npwp">NPWP</label>
                    </div>
                    <div class="table-cell py-1">
                        <input type="radio" value="1" id="have_npwp" name="npwp" /> <label for="have_npwp">Memiliki NPWP</label> <input type="radio" value="0" name="npwp" id="no_npwp" checked /> <label for="no_npwp">Tidak memiliki NPWP</label>
                    </div>
                </div>
                <div class="w-full table-row px-2">
                    <div class="table-cell py-1">
                        <label for="tax_percent">Bea Masuk</label>
                    </div>
                    <div class="table-cell py-1"><input type="number" id="tax_percent" class="rounded pl-2 border border-slate-500 bg-slate-600" max="100" min="0" step="0.1" name="tax_percent" value="7.5" />&nbsp;% <span class="text-gray-800 text-sm">Bea masuk dapat berbeda untuk beberapa jenis barang.</span></div>
                </div>

                <div class="w-full table-row px-2">
                    <button type="submit" class="px-3 py-1 border border-slate-200 rounded bg-slate-600">Hitung</button>
                </div>
                
                <!-- add all values above; then convert with today rate -->
                <!-- then calculate all tax things in IDR; remember to ceil all result below -->
                <!-- 1. CIF result + bea masuk -->
                <!-- 2. result from number 1 is then calculated with PPN 11% -->
                <!-- 3. (have NPWP will be 10%; don't have NPWP will be 20%)  -->
                <!-- 3. calculate pph based on result number 1; with the percentage above -->
                <!-- now, the final result is bea masuk + result 2 and result 3 -->
                <!-- there should be another cost from POS; or FedEx -->
            </form>

            <div id="calculationResult" class="table w-10/12 mt-5 mx-5">
                <div class="w-full table-row px-2">
                    <div class="table-cell py-1">
                        <label for="result_bea_masuk">Bea masuk</label>
                    </div>
                    <div class="table-cell py-1">
                        <input type="number" class="rounded pl-2 border border-slate-500 bg-slate-600" name="result_bea_masuk" id="result_bea_masuk" readonly />
                    </div>
                </div>
                <div class="w-full table-row px-2">
                    <div class="table-cell py-1">
                        <label for="result_ppn">PPN 11% (dari FOB + Bea masuk)</label>
                    </div>
                    <div class="table-cell py-1">
                        <input type="number" class="rounded pl-2 border border-slate-500 bg-slate-600" name="result_ppn" id="result_ppn" readonly />
                    </div>
                </div>
                <div class="w-full table-row px-2">
                    <div class="table-cell py-1">
                        <label for="result_pph">PPh</label>
                    </div>
                    <div class="table-cell py-1">
                        <input type="number" class="rounded pl-2 border border-slate-500 bg-slate-600" name="result_pph" id="result_pph" readonly />
                    </div>
                </div>
                <div class="w-full table-row px-2">
                    <div class="table-cell py-1">
                        <label for="result_total_tax">Total pajak impor</label>
                    </div>
                    <div class="table-cell py-1">
                        <input type="number" class="rounded pl-2 border border-slate-500 bg-slate-600" name="result_total_tax" id="result_total_tax" readonly />
                    </div>
                </div>
            </div>

            <div class="mx-5 bg-slate-200 mt-3 py-2 px-3 rounded border border-slate-400">
                <span class="text-red-500 text-sm">Total di atas adalah perkiraan berdasar pada perhitungan <a class="underline decoration-blue-600 text-blue-700 hover:text-blue-500" href="https://jdih.kemenkeu.go.id/fullText/2019/199~PMK.010~2019Per.pdf">PMK 199/2019</a> dan <u class="font-bold">HANYA</u> pajak dalam rangka impor. Belum termasuk biaya lain-lain seperti repack oleh POS, atau jasa pengiriman lokal dari kurir.</span>
            </div>


        </div>
        <div class="w-2/12 bg-slate-600 px-2 py-1" id="sidebar">
            <!-- Show this week rate in this section -->
            <h2 class="text-lg">Kurs minggu ini</h2>
            <div class="w-full table">
                <div class="table-header-group">
                    <div class="table-row">
                        <div class="table-cell text-left border-b border-slate-100">Mata uang</div>
                        <div class="table-cell text-left border-b border-slate-100">Nilai</div>
                    </div>
                </div>
                <div class="table-row-group" id="currencyData"></div>
            </div>
        </div>
    </div>
</body>
</html>